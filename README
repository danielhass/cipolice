CIPolicE - Container Image Policy Engine
========================================

When Docker container images are scanned for quality deficiencies and
security vulnerabilities, the outcome is a set of metrics. What would be
the next steps to act on that?

CIPolicE! This tool builds on the rule_engine framework to allow for
rule-controlled follow-up actions based on image metrics, and
furthermore ships with powerful default rules useful in containerised
environments, e.g. OpenShift.

CIPolicE integrates with web hooks from Quay to make it work as
invisible but decisive part of your container image workflow; although
other triggers are possible as well.

+----------------------+  +----------+-> shell/oc command, web hook
| Quay + Clair scanner |->| CIPolicE |-> digital signature on image
+----------------------+  +----------+-> simple accept/reject

CIPolicE is the result of a joint academic-industry research project
involving the Service Prototyping Lab of Zurich University of Applied
Sciences and Puzzle ITC, changing IT for the better.

Installation and Usage
----------------------

From source:

 cd src/
 pip(3) install -r dependencies.txt
 python3 cipolice.py -t

With container:

 docker pull nginx:latest
 docker run -ti -p 10080:10080 -v /var/run/docker.sock:/var/run/docker.sock cipolice
 curl -X POST -d '{"image": "nginx:latest", "level": 3}' http://localhost:10080/

Rules
-----

Rules follow a condition-action model, with actions indented as block
under each condition. Comments (#) are allowed. Actions can be shell
scripts (must end in .sh), Python functions (must end in .py with
colon-separated function name), or web hooks. Conditions are evaluated
over JSON-formatted dictionary messages. The special action break
terminates the rule processing per event. For an example including some
invalid rules, have a look at src/*.rules.

Image Scanner
-------------

Please have a look at the separate README file within the scanning
folder. The scanning part scans individual images and generates suitable
input for the policy engine. It is supposed to be integrated with
OpenShift, although that part is under development.
